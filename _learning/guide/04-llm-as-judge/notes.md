# LLM-as-a-Judge 학습 노트

## 핵심 개념

### LLM-as-a-Judge란?
- LLM을 평가자(judge)로 사용하여 다른 LLM의 출력을 평가
- 사람의 평가를 대체하거나 보완
- Reasoning LLM과 결합하면 더 정교한 판단 가능

### 왜 필요한가?
1. **확장성**: 사람이 수천 개의 출력을 평가하기 어려움
2. **일관성**: 사람은 피로, 기분에 따라 평가 달라짐
3. **비용**: 전문가 평가 비용 절감
4. **속도**: 실시간 품질 모니터링 가능

## 평가 패턴

### 1. Pointwise (단일 평가)
```
[응답]을 다음 기준으로 1-5점 평가하세요:
- 5점: 완벽
- 4점: 대부분 정확
- 3점: 보통
- 2점: 부족
- 1점: 매우 부족

점수: [1-5]
이유: [설명]
```

### 2. Pairwise (쌍대 비교)
```
두 응답 중 어느 것이 더 나은지 선택하세요:

[응답 A]
[응답 B]

선택: A 또는 B
이유: [설명]
```

### 3. Reference-based (정답 비교)
```
정답: [골드 스탠다드]
응답: [평가 대상]

정답과 비교하여 정확도를 평가하세요.
```

### 4. Multi-criteria (다차원 평가)
```
다음 항목 각각에 대해 평가하세요:
1. 정확성: [1-5]
2. 완전성: [1-5]
3. 가독성: [1-5]
4. 관련성: [1-5]

총평: [설명]
```

## 주의해야 할 편향

| 편향 | 설명 | 해결책 |
|------|------|--------|
| 장황함 편향 | 긴 응답을 선호 | 길이 정규화, 명확한 기준 제시 |
| 위치 편향 | 첫 번째 옵션 선호 | 순서 랜덤화, 양방향 평가 |
| 자기 선호 | 자신의 출력 선호 | 다른 모델로 평가 |
| 스타일 편향 | 특정 문체 선호 | 내용 기반 평가 강조 |

## scrape-hub 적용 아이디어

### 1. NER 결과 품질 평가
```yaml
# v4: LLM-as-Judge로 NER 검증 품질 평가
시스템: "당신은 NER 검증 시스템의 품질 평가자입니다."

입력:
  - 원본 텍스트
  - 매칭된 엔티티
  - 검증 결과 (유효/무효)
  - 검증 이유

평가 기준:
  - 판정 정확성: 유효/무효 판단이 맞는가?
  - 근거 품질: 이유가 타당하고 충분한가?
  - 일관성: 유사 케이스와 일관된 판단인가?
```

### 2. Entity Linking 신뢰도 평가
```yaml
입력:
  - 엔티티: "고혈압"
  - 후보 CUI들과 매핑 점수
  - 최종 선택된 CUI

평가:
  - 선택이 적절한가?
  - 더 나은 후보가 있는가?
  - 신뢰도 점수 (0-100)
```

### 3. 데이터 품질 검수 자동화
```yaml
입력: 크롤링된 의료 데이터

평가 항목:
  - 완전성: 필수 필드 존재 여부
  - 형식: 데이터 형식 적합성
  - 의미: 의료적으로 말이 되는가?
  - 중복: 기존 데이터와 중복 여부
```

## 구현 패턴

### Evaluator-Optimizer Loop
```
[생성 모델] → 출력 → [Judge 모델] → 피드백
                          ↓
                    피드백으로 프롬프트 개선
                          ↓
                    다시 생성...
```

### Self-Critique Pattern
```
1단계: 응답 생성
2단계: 자신의 응답 비평
3단계: 비평 기반 개선
4단계: 최종 응답
```

## 프롬프트 설계 체크리스트

- [ ] 명확한 평가 기준 (rubric) 정의
- [ ] 각 점수 레벨에 대한 예시 포함
- [ ] CoT로 추론 과정 요구
- [ ] 구조화된 출력 형식 지정
- [ ] 편향 방지 전략 적용

## v3 (CoT) vs v4 (Judge) 차이점

| 항목 | v3 (CoT) | v4 (Judge) |
|------|----------|------------|
| 목적 | 판정 + 근거 | 판정의 품질 평가 |
| 출력 | 추론 + 유효/무효 | 점수 + 피드백 |
| 용도 | 1차 검증 | 2차 품질 검수 |
| 비용 | 중간 | 높음 |

## 참고 자료 (레포 내)
- `pages/guides/reasoning-llms.en.mdx` - LLM-as-a-Judge 섹션
- `pages/prompts/evaluation.en.mdx` - 평가 프롬프트 예시
